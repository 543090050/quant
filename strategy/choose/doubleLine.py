# -*- coding: UTF-8 -*-"""@作者: 石雨风@时间: 2020/12/20@功能： 均线选股 - 买入/卖出"""import numpy as npimport pandas as pdfrom common.Context import Contextfrom util import dataUtilcontext = Context()stocks = pd.DataFrame()all_code_list = dataUtil.get_sample_stocks()['code']chunk_len = 20for code_list in np.array_split(all_code_list, len(all_code_list) / chunk_len + 1):    # todo 查询当前值    url = "http://hq.sinajs.cn/list=" + ",".join(code_list)    print(url)    for code in zip(code_list):        code = code[0]        stocks.loc[code, 'code'] = code        history_data = dataUtil.attribute_history(context, code, 30)        # 计算均线        ma8 = history_data['close'][-8:].mean()        ma30 = history_data['close'].mean()        # 填充值        stocks.loc[code, 'ma8'] = ma8        stocks.loc[code, 'ma30'] = ma30print(stocks)